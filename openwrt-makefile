#
# Copyright (C) 2006-2014 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#

include $(TOPDIR)/rules.mk

PKG_NAME:=led-server
PKG_VERSION:=0.0.1
PKG_RELEASE:=1


#PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.gz
PKG_SOURCE:=led-server
#PKG_SOURCE_URL:= @SF/xxx
#PKG_SOURCE_URL:= \
	https://github.com/cppcoder123/$(PKG_NAME)
#PKG_MD5SUM:=67c9e91285bc3801fd91a5d26ea775d7
#PKG_MAINTAINER:= cppcoder123 <cppcoder123@vfemail.net>

PKG_FIXUP:=autoreconf
PKG_INSTALL=1

include $(INCLUDE_DIR)/package.mk

define Package/led-server
  SECTION:=multimedia
  CATEGORY:=Multimedia
  TITLE:=Server to handle LED matrix
  URL:=http://github.com/cppcoder123/$(PKG_NAME)/
  DEPENDS:=+libdaemon +libstdcpp +libpthread 
endef

define Package/led-server/description
 Daemon to handle LED matrix. fixme
endef

TARGET_CPPFLAGS += \
	-std=c++11 -Wall -pedantic -g \
	-I$(STAGING_DIR)/usr/include \
	-I$(PKG_BUILD_DIR)/lib/int \
	-I$(PKG_BUILD_DIR)/lib/ext/include \

TARGET_LDFLAGS += \
	-Wl,-rpath-link=$(STAGING_DIR)/usr/lib \

MAKE_FLAGS += \
	CPPFLAGS="$(TARGET_CPPFLAGS)" \
	LDFLAGS="$(TARGET_LDFLAGS)" \

define Build/Prepare
	cp -r /<where-sources-are>/* $(PKG_BUILD_DIR)
endef

define Build/Compile
	$(MAKE) -C $(PKG_BUILD_DIR) CXX="$(TARGET_CROSS)g++" \
	  AR="$(TARGET_CROSS)ar" $(MAKE_FLAGS)
endef

define Package/led-server/install
	$(INSTALL_DIR) $(1)/usr/bin
	$(INSTALL_BIN) $(PKG_BUILD_DIR)/led-d/led-d $(1)/usr/bin/
	$(INSTALL_BIN) $(PKG_BUILD_DIR)/led-info-d/led-info-d $(1)/usr/bin/
	$(INSTALL_BIN) $(PKG_BUILD_DIR)/led/led $(1)/usr/bin/
endef

$(eval $(call BuildPackage,led-server))
